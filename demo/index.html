<!doctype html>
<!--
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>

  <title>iron-page-url</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../iron-page-url.html">
  <link rel="import" href="../iron-query-params.html">
  <link rel="import" href="../../paper-styles/classes/typography.html">
  <link rel="import" href="../../iron-flex-layout/classes/iron-flex-layout.html">
  <link rel="import" href="../../paper-input/paper-input.html">
  <link rel="import" href="../../paper-slider/paper-slider.html">
  <link rel="import" href="../../paper-button/paper-button.html">
  <link rel="stylesheet" href="../../paper-styles/demo.css">
</head>
<body>

  <dom-module id='iron-page-url-demo'>
    <template>
      <style>
        div.inputs {
          margin-bottom: 15px;
        }
        label {
          display: inline-block;
          width: 100px;
        }
        span.seconds {
        }
        [layout] {
          @apply(--layout);
        }
        [layout][horizontal] {
          @apply(--layout-horizontal);
        }
        [layout][horizontal] > div {
          padding: 20px;
          max-width: 500px;
        }
        [layout][vertical] {
          @apply(--layout-vertical);
        }
        [layout][flex] {
          @apply(--layout-flex);
        }
        h3 {
          padding: 0;
          margin: 0;
        }
      </style>
      <iron-page-url path='{{path}}' hash='{{hash}}' query='{{query}}'
                     dwell-time='{{dwellTime}}'>
      </iron-page-url>
      <iron-query-params params-string='{{query}}' params-object='{{params}}'>
      </iron-query-params>

      <div layout horizontal>
        <div layout vertical flex class='inputs'>
          <h3>URL</h3>
          <paper-input label='path' value='{{path}}' always-float-label>
          </paper-input>
          <paper-input label='hash' value='{{hash}}' always-float-label>
          </paper-input>
          <paper-input label='params' value='{{paramsString}}'
                       invalid='{{paramsInvalid}}'
                       error-message='Should be legal JSON'
                       always-float-label>
          </paper-input>
        </div>
        <div layout vertical flex class='history_entries'>
          <h3>Dwell Time</h3>
          <p>
            iron-page-url won't add extraneous entries to the browser's history when changes come in rapid fire.
          </p>
          <p>A new history entry will only be added if it stays in the same state longer than dwellTime.
          </p>
          <div>
            <label>History added: </label>
            {{historyElementsAdded}} entries
          </div>
          <div>
            <label>Dwell time:</label>
            {{inSeconds(dwellTime)}}s
          </div>
          <paper-slider min="-1" max="5000" value='2000' step='100'
                        immediate-value='{{dwellTime}}'>
          </paper-slider>
        </div>
      </div>
      <div layout horizontal flex>
        <a href='#lolol'><paper-button raised>#lolol</paper-button></a>
        <a href='?hi=there&some=none#wat_for'><div>{"hi": "there", "some": "none"}, #wat_for</div></a>
      </div>
    </template>
    <script>
      Polymer({
        is: 'iron-page-url-demo',
        properties: {
          paramsString: {
            observer: 'paramsStringChanged'
          },
          params: {
            observer: 'paramsChanged'
          },
          paramsInvalid: {
            value: false,
          },
          historyElementsAdded: {
            type: Number
          }
        },
        observers: [
          'checkHistorySize(path, hash, paramsString)'
        ],
        ready: function() {
          this.startingHistoryLength = window.history.length;
        },
        paramsStringChanged: function() {
          if (this.ignore) {
            return;
          }
          this.ignore = true;
          try {
            this.params = JSON.parse(this.paramsString);
            this.paramsInvalid = false;
          } catch(_) {
            this.paramsInvalid = true;
          }
          this.ignore = false;
        },
        paramsChanged: function() {
          if (this.ignore) {
            return;
          }
          this.ignore = true;
          this.paramsString = JSON.stringify(this.params);
          this.paramsInvalid = false;
          this.ignore = false;
        },
        checkHistorySize: function() {
          this.historyElementsAdded =
              window.history.length - this.startingHistoryLength;
        },
        inSeconds: function(dwellTime) {
          if (dwellTime === -1) {
            return -1;
          }
          return (Math.round(dwellTime / 100) / 10)
        }
      });
    </script>
  </dom-module>

  <iron-page-url-demo></iron-page-url-demo>
</body>
</html>
